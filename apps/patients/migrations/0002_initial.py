# Generated by Django 5.1.4 on 2025-01-31 13:08

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ("patients", "0001_initial"),
        ("staff", "0001_initial"),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AddField(
            model_name="historicalpatientappointment",
            name="department",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                limit_choices_to={"department_type": "CLINICAL"},
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="staff.department",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientappointment",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientappointment",
            name="modified_by",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientappointment",
            name="physician",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientchroniccondition",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientdemographics",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientdiagnoses",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientemergencycontact",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientmedicalreport",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientoperation",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientoperation",
            name="surgeon",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                limit_choices_to={"role__name__in": ["Doctor", "Head Doctor"]},
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="staff.doctorprofile",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientprescription",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientprescription",
            name="issued_by",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="staff.doctorprofile",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientvisit",
            name="history_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="patient",
            name="user",
            field=models.OneToOneField(
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="patient_profile",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientvisit",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientprescription",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientoperation",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientmedicalreport",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientdiagnoses",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientchroniccondition",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientappointment",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientallergies",
            name="patient",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="patientallergies",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="allergies",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="patientappointment",
            name="created_by",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="created_appointments",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="patientappointment",
            name="department",
            field=models.ForeignKey(
                limit_choices_to={"department_type": "CLINICAL"},
                null=True,
                on_delete=django.db.models.deletion.PROTECT,
                related_name="appointment_department",
                to="staff.department",
            ),
        ),
        migrations.AddField(
            model_name="patientappointment",
            name="modified_by",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="modified_appointments",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="patientappointment",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.PROTECT,
                related_name="appointments",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="patientappointment",
            name="physician",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.PROTECT,
                related_name="appointments",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddField(
            model_name="historicalpatientprescription",
            name="appointment",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patientappointment",
            ),
        ),
        migrations.AddField(
            model_name="patientchroniccondition",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="chronic_conditions",
                to="patients.patient",
            ),
        ),
        migrations.AddIndex(
            model_name="patientdemographics",
            index=models.Index(fields=["gender"], name="patient_dem_gender_951d6d_idx"),
        ),
        migrations.AddIndex(
            model_name="patientdemographics",
            index=models.Index(
                fields=["blood_type"], name="patient_dem_blood_t_364bea_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientdemographics",
            index=models.Index(
                fields=["preferred_language"], name="patient_dem_preferr_b18c76_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientdemographics",
            index=models.Index(
                fields=["marital_status"], name="patient_dem_marital_aee90b_idx"
            ),
        ),
        migrations.AddField(
            model_name="patient",
            name="demographics",
            field=models.OneToOneField(
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="patient_profile",
                to="patients.patientdemographics",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatient",
            name="demographics",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patientdemographics",
            ),
        ),
        migrations.AddField(
            model_name="patientdiagnoses",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="diagnoses",
                to="patients.patient",
            ),
        ),
        migrations.AddIndex(
            model_name="patientemergencycontact",
            index=models.Index(
                fields=["state", "city"], name="patient_eme_state_493cca_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientemergencycontact",
            index=models.Index(
                fields=["postal_code", "country"], name="patient_eme_postal__53f7cb_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientemergencycontact",
            index=models.Index(
                fields=["address_type", "is_primary"],
                name="patient_eme_address_98bdc4_idx",
            ),
        ),
        migrations.AddConstraint(
            model_name="patientemergencycontact",
            constraint=models.UniqueConstraint(
                condition=models.Q(("is_primary", True)),
                fields=("is_primary",),
                name="unique_primary_address_per_patient",
            ),
        ),
        migrations.AddField(
            model_name="patient",
            name="emergency_contact",
            field=models.OneToOneField(
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="patient_profile",
                to="patients.patientemergencycontact",
            ),
        ),
        migrations.AddField(
            model_name="historicalpatient",
            name="emergency_contact",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                to="patients.patientemergencycontact",
            ),
        ),
        migrations.AddField(
            model_name="patientmedicalreport",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="medical_reports",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="patientoperation",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="operations",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="patientoperation",
            name="surgeon",
            field=models.ForeignKey(
                limit_choices_to={"role__name__in": ["Doctor", "Head Doctor"]},
                on_delete=django.db.models.deletion.CASCADE,
                related_name="operations",
                to="staff.doctorprofile",
            ),
        ),
        migrations.AddField(
            model_name="patientprescription",
            name="appointment",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="prescriptions",
                to="patients.patientappointment",
            ),
        ),
        migrations.AddField(
            model_name="patientprescription",
            name="issued_by",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="issued_prescriptions",
                to="staff.doctorprofile",
            ),
        ),
        migrations.AddField(
            model_name="patientprescription",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="prescriptions",
                to="patients.patient",
            ),
        ),
        migrations.AddField(
            model_name="patientvisit",
            name="patient",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="visits",
                to="patients.patient",
            ),
        ),
        migrations.AddIndex(
            model_name="patientallergies",
            index=models.Index(
                fields=["patient"], name="patient_all_patient_71e0e2_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientallergies",
            index=models.Index(fields=["name"], name="patient_all_name_8d7884_idx"),
        ),
        migrations.AddIndex(
            model_name="patientallergies",
            index=models.Index(
                fields=["severity"], name="patient_all_severit_e3fd33_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientappointment",
            index=models.Index(
                fields=["appointment_date", "appointment_time"],
                name="patient_app_appoint_3d31b7_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="patientappointment",
            index=models.Index(
                fields=["status", "appointment_date"],
                name="patient_app_status_76394a_idx",
            ),
        ),
        migrations.AddConstraint(
            model_name="patientappointment",
            constraint=models.CheckConstraint(
                condition=models.Q(("end_time__gt", models.F("start_time"))),
                name="valid_time_range",
            ),
        ),
        migrations.AddIndex(
            model_name="patientchroniccondition",
            index=models.Index(
                fields=["patient"], name="patient_chr_patient_86031e_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientchroniccondition",
            index=models.Index(
                fields=["condition"], name="patient_chr_conditi_015f84_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientchroniccondition",
            index=models.Index(
                fields=["diagnosis_date"], name="patient_chr_diagnos_30027b_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientdiagnoses",
            index=models.Index(
                fields=["patient"], name="patient_dia_patient_13836d_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientdiagnoses",
            index=models.Index(
                fields=["diagnosis_date"], name="patient_dia_diagnos_9b0b29_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientdiagnoses",
            index=models.Index(
                fields=["diagnosis_name"], name="patient_dia_diagnos_0f2135_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientdiagnoses",
            index=models.Index(
                fields=["icd_code"], name="patient_dia_icd_cod_2032aa_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patient",
            index=models.Index(
                fields=["date_of_birth", "is_active"],
                name="patients_date_of_574365_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="patient",
            index=models.Index(fields=["pin"], name="patients_pin_8b2cff_idx"),
        ),
        migrations.AddIndex(
            model_name="patient",
            index=models.Index(
                fields=["nin_encrypted"], name="patients_nin_enc_9c2dd2_idx"
            ),
        ),
        migrations.AddConstraint(
            model_name="patient",
            constraint=models.UniqueConstraint(fields=("pin",), name="unique_pin"),
        ),
        migrations.AddIndex(
            model_name="patientmedicalreport",
            index=models.Index(
                fields=["patient"], name="patient_med_patient_f90d8b_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientmedicalreport",
            index=models.Index(fields=["title"], name="patient_med_title_420860_idx"),
        ),
        migrations.AddIndex(
            model_name="patientmedicalreport",
            index=models.Index(
                fields=["created_at"], name="patient_med_created_d7b0c6_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientmedicalreport",
            index=models.Index(
                fields=["updated_at"], name="patient_med_updated_47fee8_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientoperation",
            index=models.Index(
                fields=["operation_date", "operation_name"],
                name="patient_ope_operati_57967e_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="patientoperation",
            index=models.Index(
                fields=["operation_code"], name="patient_ope_operati_8a7383_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientprescription",
            index=models.Index(
                fields=["appointment"], name="patient_pre_appoint_45a731_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientprescription",
            index=models.Index(
                fields=["issued_by", "issued_date"],
                name="patient_pre_issued__70343c_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="patientprescription",
            index=models.Index(
                fields=["issued_date"], name="patient_pre_issued__a9e4dc_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="patientvisit",
            index=models.Index(
                fields=["visit_date", "ward_or_clinic"],
                name="patient_vis_visit_d_fd66ac_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="patientvisit",
            index=models.Index(
                fields=["discharge_date", "patient"],
                name="patient_vis_dischar_c71203_idx",
            ),
        ),
    ]
